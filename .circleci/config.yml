# Use the latest 2.1 version of CircleCI pipeline process engine. See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1
jobs:
  build:
    docker:
      - image: circleci/buildpack-deps:xenial
    environment:
      CXX: g++-5
    steps:
      - checkout
      # C++ stuff.
      - run:
        name: Ensure package DB is up-to-date
        command: 'apt-get update'
      - run:
        name: Installing C++ deps
        command: 'apt-get update && apt-get install -y
                    automake
                    autoconf
                    autoconf-archive
                    binutils-dev
                    build-essential
                    liblz4-dev
                    liblzma-dev
                    libtool
                    make
                    zlib1g-dev
                    libjemalloc-dev
                    libiberty-dev
                    libjsoncpp-dev
                    wget'
      # Newer Boost.
      - run:
        name: Installing Boost
        command: 'sudo get_boost.sh'
      # Configure.
      - run:
        name: Autoconf
        command: 'autoreconf -ivf'
      - run:
        name: Configure
        command: './configure CXX="g++-5"'
      # Actual build.
      - run:
        name: Build
        command: 'make -j'
